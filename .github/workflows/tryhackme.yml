name: TryHackMe Streak Bot

on:
  workflow_dispatch:      # optional: allow manual trigger from GitHub UI
  repository_dispatch:    # triggered via Telegram bot
    types: [trigger_thm_workflow]

jobs:
  run-bot:
    runs-on: ubuntu-latest

    env:
      TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
      TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      GH_TOKEN: ${{ secrets.GH_TOKEN }}

    steps:
      - name: üß© Checkout repository
        uses: actions/checkout@v4

      - name: üêç Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: üì¶ Install dependencies
        run: pip install -r requirements.txt

      - name: üöÄ Run TryHackMe Streak Script
        run: |
          echo "Running TryHackMe streak script..."
          python trigger_bot.py

      - name: ‚úÖ Notify success on Telegram
        if: success()
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -d text="‚úÖ TryHackMe streak bot completed successfully on $(date '+%Y-%m-%d %H:%M:%S')"

      - name: ‚ùå Notify failure on Telegram
        if: failure()
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -d text="‚ùå TryHackMe streak bot failed on $(date '+%Y-%m-%d %H:%M:%S')"
